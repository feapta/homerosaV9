var arrayOpciones=[],objetOpciones={id:"",indiceOpcion:"",opcion:"",medidas:"",color:"",notas:"",precio_compra:"",envio:"",precio_venta:"",imagen1:"",imagen2:"",imagen3:""},n=-1,na=0;function escuchaBotonOpciones(){document.querySelector(".agrega_opciones_AZ").addEventListener("click",actualizaOpciones)}function escuchaBotonOk(){document.querySelectorAll(".crear").forEach(e=>{e.addEventListener("click",añade_Opcion_array)})}async function cargaOpciones(){const e="/productos/admin/edicion_P?id="+document.querySelector("#id").value;try{const o=await fetch(e,{method:"POST"});crearOp(await o.json())}catch(e){console.log(e)}}function crearOp(e){e.data.forEach(e=>{const{id:o,opcion:c,medidas:n,color:a,notas:r,precio_compra:i,envio:t,precio_venta:u,imagen1:d,imagen2:l,imagen3:p}=e,s={id:o??null,opcion:c,medidas:n,color:a,notas:r,precio_compra:i,envio:t,precio_venta:u,imagen1:d,imagen2:l,imagen3:p};arrayOpciones=[...arrayOpciones,s],actualizaOpciones()}),setTimeout(llenarOpciones,500),console.log(arrayOpciones)}function llenarOpciones(e){escuchaBotonOk();for(let e=0;e<arrayOpciones.length;e++){n=e,document.querySelector(".idOpcion"+e).value=e,document.querySelector(".selectOpciones"+e).value=arrayOpciones[e].opcion,document.querySelector(".inputmedidas"+e).value=arrayOpciones[e].medidas,document.querySelector(".inputcolor"+e).value=arrayOpciones[e].color,document.querySelector(".textareaOp"+e).value=arrayOpciones[e].notas,document.querySelector(".precioCoOpcion"+e).value=arrayOpciones[e].precio_compra,document.querySelector(".envioOpcion"+e).value=arrayOpciones[e].envio,document.querySelector(".precioVeOpcion"+e).value=arrayOpciones[e].precio_venta,document.querySelector(".imga"+e).src="/imagenes_productos/"+arrayOpciones[e].imagen1,document.querySelector(".imgb"+e).src="/imagenes_productos/"+arrayOpciones[e].imagen2,document.querySelector(".imgc"+e).src="/imagenes_productos/"+arrayOpciones[e].imagen3;const o=document.querySelector(".ok"+e);o.classList.remove("edicion"),o.src="/build/img/truck/ok_verde.png"}}function añade_Opcion_array(){const e={id:"",opcion:document.querySelector(".selectOpciones"+n).value,medidas:document.querySelector(".inputmedidas"+n).value,color:document.querySelector(".inputcolor"+n).value,notas:document.querySelector(".textareaOp"+n).value,precio_compra:document.querySelector(".precioCoOpcion"+n).value,envio:document.querySelector(".envioOpcion"+n).value,precio_venta:document.querySelector(".precioVeOpcion"+n).value,imagen1:document.querySelector(".imga"+n).files,imagen2:document.querySelector(".imgb"+n).files,imagen3:document.querySelector(".imgc"+n).files};arrayOpciones[n]=e,console.log(arrayOpciones)}async function guardarProducto(){const e=document.querySelector("#select_categoria").value,o=document.querySelector("#titulo").value,c=document.querySelector("#unidades").value,a=document.querySelector("#video"),r=document.querySelector("#tienda").value,i=document.querySelector("#enlace").value,t=document.querySelector("#fecha_entrada").value,u=document.querySelector("#fechafin_novedad").value,d=document.querySelector(".imga"+n),l=document.querySelector(".imgb"+n),p=document.querySelector(".imgc"+n),s=new FormData;s.append("idcate",e),s.append("titulo",o),s.append("unidades",c),s.append("video",a),s.append("tienda",r),s.append("enlace",i),s.append("fecha_entrada",t),s.append("fechafin_novedad",u),s.append("opciones",JSON.stringify(arrayOpciones));for(let e of a.files)s.append("files[video][]",e);for(let e of d.files)s.append("files[imagen1][]",e);for(let e of l.files)s.append("files[imagen2][]",e);for(let e of p.files)s.append("files[imagen3][]",e);try{const e="/productos/admin/guardar",o=await fetch(e,{method:"POST",body:s,contentType:!1,processData:!1});await o.json()&&(Swal.fire({icon:"success",title:"Producto guardado correctamente",showConfirmButton:!1,timer:1500}),setTimeout(()=>{window.location.href="/productos/admin"},1500))}catch(e){console.log(e)}}document.addEventListener("DOMContentLoaded",(function(){cargaOpciones(),escuchaBotonOpciones()}));
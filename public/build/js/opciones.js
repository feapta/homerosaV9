var indiceOpciones=-1,arrayOpciones=[],objetOpciones={id:"",indiceOpcion:"",opcion:"",medicas:"",precio_compra:"",envio:"",precio_venta:"",imagen:""};function escuchaBotonOk(){document.querySelectorAll(".ok").forEach(e=>{e.addEventListener("click",Opcion)})}function Opcion(e){const o=e.target.parentElement.parentElement.querySelector(".ok");o.classList.contains("crear")&&(o.src="/build/img/truck/ok_verde.png",o.classList.remove("crear"),console.log("CREAR"),crearOpcion(e)),o.classList.contains("edicion")&&(o.classList.remove("edicion"),o.src="/build/img/truck/ok_verde.png",console.log("MODIFICAR"),modificaOpcion(e))}function crearOpcion(e){const o=e.target.parentElement.parentElement.parentElement,n={id:"",indiceOpcion:indiceOpciones,opcion:o.querySelector(".selectOpciones").value,medidas:o.querySelector(".inputmedidas").value,precio_compra:o.querySelector(".precioCoOpcion").value,envio:o.querySelector(".envioOpcion").value,precio_venta:o.querySelector(".precioVeOpcion").value,imagen:o.querySelector(".img1").files};arrayOpciones=[...arrayOpciones,n],escuchaCambios(),botonActiva()}function modificaOpcion(e){const o=e.target.parentElement.parentElement.parentElement,n=o.querySelector(".indiceOpcion").value;objetOpciones[n]={id:"",indiceOpcion:o.querySelector(".indiceOpcion").value,opcion:o.querySelector(".selectOpciones").value,medidas:o.querySelector(".inputmedidas").value,precio_compra:o.querySelector(".precioCoOpcion").value,envio:o.querySelector(".envioOpcion").value,precio_venta:o.querySelector(".precioVeOpcion").value,imagen:o.querySelector(".img1").files},arrayOpciones[n]=objetOpciones[n],botonActiva()}function escuchaBotonEliminar(){document.querySelectorAll(".eliminar").forEach(e=>{e.addEventListener("click",funcionEliminar)})}function funcionEliminar(e){console.log("has echo click en ELIMINAR");const o=e.target.parentElement.parentElement.parentElement;let n=o.querySelector(".indiceOpcion").value;arrayOpciones.splice(n,1),$(o).closest("div").remove(),indiceOpciones--}async function guardarProducto(){const e=document.querySelector("#autonumero").value,o=document.querySelector("#select_categoria").value,n=document.querySelector("#titulo").value,c=document.querySelector("#unidades").value,i=document.querySelector("#video"),t=document.querySelector("#tienda").value,a=document.querySelector("#enlace").value,r=document.querySelector("#fecha_entrada").value,l=document.querySelector("#fechafin_novedad").value,u=document.querySelector(".img1"),p=new FormData;p.append("autonumero",e),p.append("idcate",o),p.append("titulo",n),p.append("unidades",c),p.append("video",i),p.append("tienda",t),p.append("enlace",a),p.append("fecha_entrada",r),p.append("fechafin_novedad",l),p.append("opciones",JSON.stringify(arrayOpciones));for(let e of i.files)p.append("files[video][]",e);for(let e of u.files)p.append("files[imagen][]",e);try{const e="/productos/admin/guardar",o=await fetch(e,{method:"POST",body:p,contentType:!1,processData:!1});await o.json()&&(Swal.fire({icon:"success",title:"Producto guardado correctamente",showConfirmButton:!1,timer:1500}),setTimeout(()=>{window.location.href="/productos/admin"},1500))}catch(e){console.log(e)}}function escuchaBotonOpciones(){document.querySelector(".agrega_opciones_CR").addEventListener("click",crearOpciones)}document.addEventListener("DOMContentLoaded",(function(){botonDesactiva(),escuchaBotonOpciones(),escuchaBotonOk(),escuchaBotonEliminar()}));